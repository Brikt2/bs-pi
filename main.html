<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infoskjerm</title>
</head>
<body>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');

        :root {
            --primary-color: #d6001c;  
            --text-color: #1a1a1a;
            --background-color: #f5f5f5;
            --departure-bg: #ffffff;
            --realtime-color: #4caf50;
            --box-radius: 12px;
            --box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            --font-lineName: "Inter", sans-serif;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                        Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        h2 {
            font-size: clamp(32px, 5vw, 48px);
            font-weight: 900;
            margin-bottom: 16px;
            color: var(--text-color);
            position: relative;
            padding-bottom: 8px;
        }

        h2::after {
            content: "";
            display: block;
            width: 60px;
            height: 4px;
            background-color: var(--primary-color);
            margin-top: 4px;
            border-radius: 2px;
        }

        h3 {
            font-size: clamp(20px, 3vw, 28px);
            font-weight: 700;
            margin: 24px 0 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h3::before {
            content: "";
            display: block;
            width: 6px;
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .departure-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .departures {
            background: var(--departure-bg);
            padding: 16px 20px;
            border-radius: var(--box-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .departures:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .lineBox {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .lineNumber {
            background-color: var(--primary-color);
            color: #ffffff;
            font-weight: 700;
            font-size: 24px;  
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;          
            height: 56px;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .lineName {
            font-family: var(--font-lineName);
            font-size: 20px;      
            font-weight: 600;
        }

        .departureTime {
            font-size: 20px;      
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .realtimeDot {
            width: 10px;
            height: 10px;
            background: var(--realtime-color);
            border-radius: 50%;
            display: inline-block;
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            h2 { font-size: 28px; }
            h3 { font-size: 18px; }
            .lineNumber { width: 48px; height: 48px; font-size: 20px; }
            .lineName { font-size: 18px; }
            .departureTime { font-size: 18px; }
        }

    </style>
    <h2>Jakob Kirke</h2>
    <h3>Retning sentrum</h3>
    <div id="departuresSentrum">Loading...</div>
    
    <h3>Den andre retningen</h3>
    <div id="departuresOtherWay">Loading...</div>

    <script>
        async function fetchDepartures() {
        const url = "https://api.entur.io/journey-planner/v3/graphql";

        try {
            const response = await fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "ET-Client-Name": "Infoboard-app",
            },
            body: JSON.stringify({
                query: `
                {
                    stopPlace(id: "NSR:StopPlace:6435") {
                    id
                    name
                    estimatedCalls(timeRange: 72100, numberOfDepartures: 12) {
                        realtime
                        aimedArrivalTime
                        expectedArrivalTime
                        destinationDisplay {
                        frontText
                        }
                        serviceJourney {
                        journeyPattern {
                            line {
                            id
                            transportMode
                            }
                        }
                        }
                    }
                    }
                }
                `,
            }),
            });

            if (!response.ok) throw new Error(`Response ${response.status}`);

            departuresData = await response.json();
            showDepartures();
        } catch (error) {
            console.error("Fetch error:", error.message);
        }
        }

        function formatDepartureTime(expectedArrival) {
        const now = new Date();
        const timeDiff = Math.floor((expectedArrival - now) / 1000 / 60);

        if (timeDiff <= 0) return "nå";
        if (timeDiff <= 15) return timeDiff + " min";

        return expectedArrival.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function showDepartures() {
        const sentrum = ["Kværnerbyen", "Ekeberg hageby"];
        const otherWay = ["Kjelsås stasjon", "Tåsen"];

        const calls = departuresData.data?.stopPlace?.estimatedCalls || [];
        const containerSentrum = document.getElementById("departuresSentrum");
        const containerOtherWay = document.getElementById("departuresOtherWay");

        containerSentrum.innerHTML = "";
        containerOtherWay.innerHTML = "";

        for (let call of calls) {
            const frontText = call.destinationDisplay.frontText;
            const lineId = call.serviceJourney.journeyPattern.line.id.split(":").pop();
            const expectedArrival = new Date(call.expectedArrivalTime);

            const div = document.createElement("div");
            div.classList.add("departures");
            div.innerHTML = `
            <div class="lineBox">
                <span class="lineNumber">${lineId}</span>
                <span class="lineName">${frontText}</span>
            </div>
            <span class="departureTime">${formatDepartureTime(expectedArrival)}</span>
            `;

            if (sentrum.includes(frontText)) containerSentrum.appendChild(div);
            else if (otherWay.includes(frontText)) containerOtherWay.appendChild(div);
        }
        }

        setInterval(fetchDepartures, 30000);
        fetchDepartures();
        setInterval(showDepartures, 9000);

    </script>
</body>
</html>
